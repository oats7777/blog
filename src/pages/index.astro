---
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import BlogCard from '@/components/BlogCard.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import styles from '@/styles/Home.module.css';

// íƒ€ì… ì •ì˜
type PostEntry = CollectionEntry<'posts'>;
type BlogCardProps = {
  title: string;
  description: string;
  slug: string;
  date: string;
  category?: string;
  readTime?: string;
  tags: string[];
};

// Content Collectionsì—ì„œ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
const allPosts = await getCollection('posts');

// ì „ì²´ ë°œí–‰ëœ í¬ìŠ¤íŠ¸
const allPublishedPosts = allPosts.filter((post: PostEntry) => !post.data.draft);

// ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ìµœì‹  3ê°œ í¬ìŠ¤íŠ¸ë§Œ ê°€ì ¸ì˜¤ê¸°
const recentPosts: BlogCardProps[] = allPublishedPosts
  .sort((a: PostEntry, b: PostEntry) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3)
  .map(
    (post: PostEntry): BlogCardProps => ({
      title: post.data.title,
      description: post.data.description,
      slug: post.slug,
      date: post.data.date,
      category: post.data.category,
      readTime: post.data.readTime,
      tags: post.data.tags,
    })
  );
---

<Layout title="Minkyu's Tech Blog - í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì¸ì‚¬ì´íŠ¸">
  <Header />

  <main>
    <!-- Hero Section -->
    <section class={styles.hero}>
      <div class={`container ${styles.heroContainer}`}>
        <div class="hero-content">
          <h1 class={styles.heroTitle}>
            ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br />
            ì €ëŠ” <span class={styles.highlight}>Minkyu</span>ì…ë‹ˆë‹¤
          </h1>
          <p class={styles.heroDescription}>
            í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë¡œì„œ ì €ì˜ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤.<br />
          </p>
          <div class={styles.heroActions}>
            <a href="/posts" class={`${styles.btn} ${styles.btnPrimary}`}>ìµœì‹  ê¸€ ë³´ê¸°</a>
            <a href="/about" class={`${styles.btn} ${styles.btnSecondary}`}>ì†Œê°œ ë³´ê¸°</a>
          </div>
        </div>

        <div class={styles.heroVisual}>
          <div class={styles.codeSnippet}>
            <div class={styles.codeHeader}>
              <span class="code-lang">JavaScript</span>
            </div>
            <pre><code>{`const minkyu = {
  role: 'Frontend Developer',
  passion: 'âˆ',
  learning: 'continuous',
  sharing: true,
  
  createAwesome() {
    return this.passion + 
           this.learning + 
           this.sharing;
  }
};`}</code></pre>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Posts Section -->
    <section class={styles.recentPosts}>
      <div class="container">
        <div class={styles.sectionHeader}>
          <h2>ìµœê·¼ ê¸€</h2>
          <a href="/posts" class={styles.viewAll}>ëª¨ë“  ê¸€ ë³´ê¸° â†’</a>
        </div>

        <div class={styles.postsGrid}>
          {
            recentPosts.length > 0 ? (
              recentPosts.map((post: BlogCardProps) => <BlogCard {...post} />)
            ) : (
              <p class={styles.noPosts}>ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            )
          }
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
